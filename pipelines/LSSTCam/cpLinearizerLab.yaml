description: cp_pipe LSSTCam linearity calibration construction.
instrument: lsst.obs.lsst.LsstCam
imports:
  - location: $CP_PIPE_DIR/pipelines/_ingredients/cpLinearizerLSST.yaml
tasks:
  cpLinearizerPtcExtractPair:
    class: lsst.cp.pipe.ptc.PhotonTransferCurveExtractPairTask
    config:
      useEfdPhotodiodeData: false
      doExtractPhotodiodeData: true
      auxiliaryHeaderKeys: ["CCOBCURR", "CCOBFLUX", "TEMP6"]
      matchExposuresType: FLUX
  cpLinearizerPtcSolve:
    class: lsst.cp.pipe.ptc.PhotonTransferCurveSolveTask
    config:
      sigmaCutPtcOutliers: 5.0
      maxDeltaInitialPtcOutlierFit: 1_000
      maxSignalInitialPtcOutlierFit: 20_000
      extendRollofSearchMaskSizeAdu: 5_000
      scaleMaxSignalInitialPtcOutlierFit: False
      doModelPtcRolloff: True
      maxPtcRolloffDeviation: 0.005
  cpLinearizerUnnormalizedSolve1:
    class: lsst.cp.pipe.LinearityDoubleSplineSolveTask
    config:
      usePhotodiode: true
      doAutoGrouping: false
      minPhotodiodeCurrent: 3e-10
      groupingColumn: CCOBCURR
      absoluteSplineFitTemperatureColumn: TEMP6
      doAbsoluteSplineFitOffset: true
      doAbsoluteSplineFitWeights: false
      doAbsoluteSplineFitTemperature: false
      doAbsoluteSplineFitTemporal: true
      absoluteSplineFitMaxIter: 40
      absoluteSplineFitWeightParsStart: [7.2e-5, 1e-4]
  cpLinearizerNormalize1:
    class: lsst.cp.pipe.LinearityNormalizeTask
    config:
      normalizeDetectors:
        - 44
        - 51
        - 52
        - 53
        - 60
        - 83
        - 90
        - 91
        - 92
        - 99
        - 86
        - 93
        - 94
        - 95
        - 102
        - 89
        - 96
        - 97
        - 98
        - 105
        - 128
        - 135
        - 136
        - 137
        - 144
      referenceDetector: 94
  cpLinearizerUnnormalizedSolve2:
    class: lsst.cp.pipe.LinearityDoubleSplineSolveTask
    config:
      usePhotodiode: true
      doAutoGrouping: false
      minPhotodiodeCurrent: 3e-10
      groupingColumn: CCOBCURR
      absoluteSplineFitTemperatureColumn: TEMP6
      doAbsoluteSplineFitOffset: true
      doAbsoluteSplineFitWeights: false
      doAbsoluteSplineFitTemperature: false
      doAbsoluteSplineFitTemporal: true
      absoluteSplineFitMaxIter: 40
      absoluteSplineFitWeightParsStart: [7.2e-5, 1e-4]
  cpLinearizerNormalize2:
    class: lsst.cp.pipe.LinearityNormalizeTask
    config:
      normalizeDetectors:
        - 44
        - 51
        - 52
        - 53
        - 60
        - 83
        - 90
        - 91
        - 92
        - 99
        - 86
        - 93
        - 94
        - 95
        - 102
        - 89
        - 96
        - 97
        - 98
        - 105
        - 128
        - 135
        - 136
        - 137
        - 144
      referenceDetector: 94
  cpLinearizerSolve:
    class: lsst.cp.pipe.LinearityDoubleSplineSolveTask
    config:
      usePhotodiode: true
      doAutoGrouping: false
      minPhotodiodeCurrent: 3e-10
      groupingColumn: CCOBCURR
      absoluteSplineFitTemperatureColumn: TEMP6
      doAbsoluteSplineFitOffset: true
      doAbsoluteSplineFitWeights: false
      doAbsoluteSplineFitTemperature: false
      doAbsoluteSplineFitTemporal: true
      absoluteSplineFitMaxIter: 40
      absoluteSplineFitWeightParsStart: [7.2e-5, 1e-4]
